---
name: Dylan Manfre and Natalie Davis
title: "R Notebook"
output: html_notebook
---

Notes
- Link to the data I downloaded from PG Open Data https://data.princegeorgescountymd.gov/Public-Safety/Crime-Incidents-February-2017-to-5th-July-2023/wb4e-w4nf

library
```{r}
library(tidyverse)
library(janitor)
library(lubridate)
#install.packages('tidygeocoder')
library(tidygeocoder)
install.packages("curl")
library(curl)
```

loading data
```{r}
pg_county_crime <-  read.csv("data/pg_county_crime.csv")
```

______

cleaning data
```{r}
pg_county_crime <- pg_county_crime %>% 
  clean_names()

```
making the dates appropreate
```{r}

#extracting the year column and making the date the correct format
pg_county_crime <- pg_county_crime %>%
  mutate(date = as.Date(date, format = "%m/%d/%Y"),
          year = year(date),
         month = month(date))

# Renaming the crime column to be easier to work with
pg_county_crime <-  pg_county_crime %>% 
  rename(crime_type = clearance_code_inc_type)

```

Showing distinct crimes: 22 types of crime here.
```{r}
pg_county_crime %>% 
  distinct(crime_type)
```
Ditching records before 2020. We are doing this because we felt records 2020 to 2023 provided a good average.
```{r}

pg_county_crime <- pg_county_crime %>% 
  filter(year >= 2020)

```


----- Exploratory data section -------

What I want to accomplish here?
- I want to see monthly data that goes back a few years for stolen, auto. DONE

filtering for AUTO, STOLEN
```{r}
stolen_auto <- pg_county_crime %>% 
  filter(crime_type == "AUTO, STOLEN" | crime_type == "AUTO, STOLEN & RECOVERED" )
```
Time elements
```{r}
# yearly data
yearly_data <- stolen_auto %>%
  group_by(year) %>%
  summarize(count = n()) %>% 
  mutate(perc = (count / sum(count)) * 100)

```
Confirms a steady increase from 2020 to 2023. 
Showing on a graph to visualize the increase.
```{r}
ggplot() + 
  geom_bar(
    data=yearly_data, 
    aes(x=year, weight=`count`))
```
monthly totals

```{r}
# What I did here first was make individual month totals by year. I thought there was a condenced way to do this so I used Chat GPT to write this look to iterate over each year from 2017 to 2023. 

# My next attempt was at making a loop before Derek suggested making a month/year column

month_total <- stolen_auto %>% 
  group_by(month, year) %>% 
  summarize(count = n()) %>% 
  mutate(month = month(month, label = TRUE)) %>% 
  arrange(desc(count))
```
auto stolen and recovered notes: There were 782 cars stolen and recovered of the 11,744 which is roughly 7%
```{r}
stolen_recovered_only <- pg_county_crime %>% 
  filter(crime_type == "AUTO, STOLEN & RECOVERED")

#What percentage were stolen
perc_stolen <- stolen_auto %>% 
  group_by(crime_type) %>% 
  summarize(count = n()) %>% 
  mutate(perc = (count / sum(count)) * 100)
```
yearly total for stolen and recovered
```{r}

stolen_recovered_years <- stolen_recovered_only %>%
  group_by(year) %>%
  summarize(count = n())

```
```{r}
test <-  stolen_auto %>% 
  filter(incident_case_id == "PP21062600000290")
```


Reverse geocoding section

This was a test on a smaller data set and it worked. 
```{r}
reverse_geocoding_stolen_auto <- stolen_auto %>%
  reverse_geocode(lat = latitude, long = longitude, method = 'osm',
                  address = street_address, full_results = TRUE)

```









